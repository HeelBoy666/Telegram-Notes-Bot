{% extends "base.html" %}

{% block title %}Dashboard - –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å{% endblock %}

{% block content %}
<div class="row">
    <!-- –°—Ç–∞—Ç—É—Å –±–æ—Ç–∞ -->
    <div class="col-12 mb-4">
        <div class="card">
            <div class="card-body">
                <div class="row align-items-center">
                    <div class="col-md-6">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-robot"></i> –°—Ç–∞—Ç—É—Å –±–æ—Ç–∞
                        </h5>
                        <small class="text-muted">–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: <span id="last-update">{{ "—Å–µ–π—á–∞—Å" }}</span></small>
                    </div>
                    <div class="col-md-6 text-end">
                        <span class="badge bg-{{ 'success' if bot_status == 'running' else 'danger' }} fs-6">
                            <i class="fas fa-circle"></i> 
                            {{ '–û–Ω–ª–∞–π–Ω' if bot_status == 'running' else '–û—Ñ–ª–∞–π–Ω' }}
                        </span>
                        <div class="btn-group ms-2" role="group">
                            <button type="button" class="btn btn-sm btn-success" onclick="controlBot('start')">
                                <i class="fas fa-play"></i> –ó–∞–ø—É—Å—Ç–∏—Ç—å
                            </button>
                            <button type="button" class="btn btn-sm btn-danger" onclick="controlBot('stop')">
                                <i class="fas fa-stop"></i> –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
                            </button>
                        </div>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-md-4">
                        <small class="text-muted">
                            <i class="fas fa-clock"></i> –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã: 
                            <span id="bot-uptime">{{ "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ" }}</span>
                        </small>
                    </div>
                    <div class="col-md-4">
                        <small class="text-muted">
                            <i class="fas fa-database"></i> –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: 
                            <span id="db-status">{{ "–ü–æ–¥–∫–ª—é—á–µ–Ω–∞" }}</span>
                        </small>
                    </div>
                    <div class="col-md-4">
                        <small class="text-muted">
                            <i class="fas fa-sync"></i> –û–±–Ω–æ–≤–ª–µ–Ω–∏—è: 
                            <span id="update-status">{{ "–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏" }}</span>
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
    <div class="col-md-3 mb-4">
        <div class="card bg-primary text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <h6 class="card-title">–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h6>
                        <h2 class="mb-0" id="total-users">{{ stats.total_users or 0 }}</h2>
                    </div>
                    <div class="align-self-center">
                        <i class="fas fa-users fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-3 mb-4">
        <div class="card bg-success text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <h6 class="card-title">–û–±—ã—á–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h6>
                        <h2 class="mb-0" id="regular-users">{{ stats.regular_users or 0 }}</h2>
                    </div>
                    <div class="align-self-center">
                        <i class="fas fa-user fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-3 mb-4">
        <div class="card bg-warning text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <h6 class="card-title">Admin</h6>
                        <h2 class="mb-0" id="admin-users">{{ stats.admin_users or 0 }}</h2>
                    </div>
                    <div class="align-self-center">
                        <i class="fas fa-user-shield fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-3 mb-4">
        <div class="card bg-danger text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <h6 class="card-title">–ì–ª–∞–≤–Ω—ã–µ –∞–¥–º–∏–Ω—ã</h6>
                        <h2 class="mb-0" id="boss-users">{{ stats.boss_users or 0 }}</h2>
                    </div>
                    <div class="align-self-center">
                        <i class="fas fa-crown fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–æ–±—ã—Ç–∏–π -->
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-chart-bar"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–æ–±—ã—Ç–∏–π
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-6">
                        <div class="text-center">
                            <h3 class="text-primary" id="total-events">{{ stats.total_events or 0 }}</h3>
                            <p class="text-muted">–í—Å–µ–≥–æ —Å–æ–±—ã—Ç–∏–π</p>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="text-center">
                            <h3 class="text-success" id="events-24h">{{ stats.events_24h or 0 }}</h3>
                            <p class="text-muted">–ó–∞ 24 —á–∞—Å–∞</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ -->
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-share-alt"></i> –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-6">
                        <div class="text-center">
                            <h3 class="text-info" id="total-referrals">{{ stats.total_referrals or 0 }}</h3>
                            <p class="text-muted">–í—Å–µ–≥–æ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤</p>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="text-center">
                            <h3 class="text-warning" id="unique-referrers">{{ stats.unique_referrers or 0 }}</h3>
                            <p class="text-muted">–£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ä–µ—Ñ–µ—Ä–µ—Ä–æ–≤</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
    <div class="col-12 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-bolt"></i> –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3 mb-2">
                        <button class="btn btn-outline-primary w-100" onclick="openSendMessageModal()">
                            <i class="fas fa-paper-plane"></i> –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
                        </button>
                    </div>
                    <div class="col-md-3 mb-2">
                        <button class="btn btn-outline-success w-100" onclick="refreshStats()">
                            <i class="fas fa-sync"></i> –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                        </button>
                    </div>
                    <div class="col-md-3 mb-2">
                        <button class="btn btn-outline-info w-100" onclick="viewSystemInfo()">
                            <i class="fas fa-info-circle"></i> –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ
                        </button>
                    </div>
                    <div class="col-md-3 mb-2">
                        <button class="btn btn-outline-warning w-100" onclick="testConnection()">
                            <i class="fas fa-network-wired"></i> –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è -->
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-list"></i> –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è
                </h5>
            </div>
            <div class="card-body">
                {% if recent_events %}
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>–¢–∏–ø</th>
                                <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                                <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
                                <th>–í–∞–∂–Ω–æ—Å—Ç—å</th>
                                <th>–í—Ä–µ–º—è</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for event in recent_events %}
                            <tr>
                                <td>
                                    <span class="badge bg-secondary">{{ event[0] }}</span>
                                </td>
                                <td>{{ event[1] }}</td>
                                <td>
                                    {% if event[2] %}
                                        {% if event[5] %}
                                            <span class="user-link" data-bs-toggle="popover" data-bs-trigger="hover" 
                                                  data-user-id="{{ event[2] }}" data-username="{{ event[5] }}"
                                                  data-bs-html="true"
                                                  data-bs-content="<div class='user-popover'><div class='user-avatar'><i class='fas fa-user-circle fa-2x'></i></div><div class='user-info'><strong>{{ event[5] }}</strong><br><small class='text-muted'>ID: {{ event[2] }}</small><br><small class='text-primary'>üëÜ –ù–∞–∂–º–∏—Ç–µ –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è</small><br><small class='text-info'>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ ‚Ä¢ üìù –ó–∞–º–µ—Ç–∫–∏ ‚Ä¢ üë• –†–µ—Ñ–µ—Ä–∞–ª—ã</small></div></div>">
                                                <i class="fas fa-user-circle me-1"></i>{{ event[5] }}
                                            </span>
                                        {% else %}
                                            <span class="user-link" data-bs-toggle="popover" data-bs-trigger="hover" 
                                                  data-user-id="{{ event[2] }}" data-username="user{{ event[2] }}"
                                                  data-bs-html="true"
                                                  data-bs-content="<div class='user-popover'><div class='user-avatar'><i class='fas fa-user-circle fa-2x'></i></div><div class='user-info'><strong>user{{ event[2] }}</strong><br><small class='text-muted'>ID: {{ event[2] }}</small><br><small class='text-warning'>‚ö†Ô∏è –ë–µ–∑ username</small><br><small class='text-primary'>üëÜ –ù–∞–∂–º–∏—Ç–µ –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è</small><br><small class='text-info'>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ ‚Ä¢ üìù –ó–∞–º–µ—Ç–∫–∏ ‚Ä¢ üë• –†–µ—Ñ–µ—Ä–∞–ª—ã</small></div></div>">
                                                <i class="fas fa-user-circle me-1"></i>user{{ event[2] }}
                                            </span>
                                        {% endif %}
                                    {% else %}
                                        <span class="text-muted"><i class="fas fa-cog me-1"></i>–°–∏—Å—Ç–µ–º–∞</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if event[3] == 'info' %}
                                        <span class="badge bg-info">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</span>
                                    {% elif event[3] == 'warning' %}
                                        <span class="badge bg-warning">–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ</span>
                                    {% elif event[3] == 'error' %}
                                        <span class="badge bg-danger">–û—à–∏–±–∫–∞</span>
                                    {% elif event[3] == 'critical' %}
                                        <span class="badge bg-dark">–ö—Ä–∏—Ç–∏—á–Ω–æ</span>
                                    {% else %}
                                        <span class="badge bg-secondary">{{ event[3] }}</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <small class="text-muted">{{ event[4] }}</small>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="text-center text-muted">
                    <i class="fas fa-inbox fa-3x mb-3"></i>
                    <p>–ü–æ–∫–∞ –Ω–µ—Ç —Å–æ–±—ã—Ç–∏–π</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è -->
<div class="modal fade" id="sendMessageModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="messageUserId" class="form-label">ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                    <div class="input-group">
                        <input type="number" class="form-control" id="messageUserId" placeholder="–í–≤–µ–¥–∏—Ç–µ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
                        <button class="btn btn-outline-secondary" type="button" onclick="setMyId()">–ú–æ–π ID</button>
                        <button class="btn btn-outline-warning" type="button" onclick="sendToAll()">–í—Å–µ–º</button>
                    </div>
                </div>
                <div class="mb-3">
                    <label for="messageText" class="form-label">–°–æ–æ–±—â–µ–Ω–∏–µ</label>
                    <textarea class="form-control" id="messageText" rows="3" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                <button type="button" class="btn btn-primary" onclick="sendMessage()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function controlBot(action) {
    fetch('/api/bot/status', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({action: action})
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showNotification(data.message || '–ë–æ—Ç —É—Å–ø–µ—à–Ω–æ ' + (action === 'start' ? '–∑–∞–ø—É—â–µ–Ω' : '–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω'), 'success');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –±–æ—Ç–∞
            updateBotStatus(data.status);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
                updateRealtimeStats();
            }, 2000);
        } else {
            showNotification(data.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –±–æ—Ç–æ–º', 'error');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –±–æ—Ç–æ–º', 'error');
    });
}

// –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è

function openSendMessageModal() {
    const modal = new bootstrap.Modal(document.getElementById('sendMessageModal'));
    document.getElementById('messageUserId').value = '';
    document.getElementById('messageText').value = '';
    modal.show();
}

function sendMessage() {
    const userId = document.getElementById('messageUserId').value;
    const message = document.getElementById('messageText').value;
    
    if (!userId || !message) {
        showNotification('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è', 'warning');
        return;
    }
    
    sendMessageToUser(userId, message);
    
    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
    const modal = bootstrap.Modal.getInstance(document.getElementById('sendMessageModal'));
    modal.hide();
}

function setMyId() {
    // –ü–æ–ª—É—á–∞–µ–º ID —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ —Å–µ—Å—Å–∏–∏
    fetch('/api/user/current')
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                document.getElementById('messageUserId').value = data.user_id;
                showNotification('ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω', 'success');
            } else {
                showNotification('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è', 'error');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            showNotification('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è', 'error');
        });
}

function sendToAll() {
    const message = document.getElementById('messageText').value;
    
    if (!message) {
        showNotification('–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è', 'warning');
        return;
    }
    
    if (confirm('–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –í–°–ï–ú –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) {
        fetch('/api/bot/send-message-all', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                message: message
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showNotification(data.message, 'success');
                // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
                const modal = bootstrap.Modal.getInstance(document.getElementById('sendMessageModal'));
                modal.hide();
            } else {
                showNotification(data.message || '–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è', 'error');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            showNotification('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è', 'error');
        });
    }
}

function refreshStats() {
    updateRealtimeStats();
    showNotification('–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞', 'success');
}

function viewSystemInfo() {
    fetch('/api/system/info')
        .then(response => response.json())
        .then(data => {
            const info = `–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ:\n\n` +
                        `–†–∞–∑–º–µ—Ä –ë–î: ${data.db_size}\n` +
                        `–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã: ${data.uptime}\n` +
                        `CPU: ${data.system?.cpu_percent || 'N/A'}%\n` +
                        `–ü–∞–º—è—Ç—å: ${data.system?.memory_percent || 'N/A'}%\n` +
                        `–î–∏—Å–∫: ${data.system?.disk_percent || 'N/A'}%`;
            alert(info);
        })
        .catch(error => {
            showNotification('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–∏—Å—Ç–µ–º–µ', 'error');
        });
}

function testConnection() {
    fetch('/api/system/test-connection')
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showNotification('–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —É—Å–ø–µ—à–Ω–æ', 'success');
            } else {
                showNotification('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö', 'error');
            }
        })
        .catch(error => {
            showNotification('–û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è', 'error');
        });
}

// –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
setInterval(function() {
    fetch('/api/stats')
    .then(response => response.json())
    .then(data => {
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
        updateStatsCards(data);
    })
    .catch(error => console.error('Error updating stats:', error));
}, 30000);
</script>
{% endblock %} 